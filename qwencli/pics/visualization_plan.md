# 可视化分析思路与设计

为了专业、细致、详细地展示问题一和问题二的求解结果，我们将创建一系列可视化图表。这些图表将存放在 `pics` 文件夹中，并以 SVG 格式保存以确保高质量。

## 1. 问题一 (确定性优化) 可视化

### 1.1. 数据概览
- **图表1: 所有站点预测需求分布直方图**
  - **目的**: 展示输入数据的基本特征。
  - **设计**: 使用 Matplotlib 绘制直方图，X轴为预测需求值，Y轴为站点频数。添加统计信息（均值、中位数）。
  - **文件名**: `p1_demand_histogram.svg`

### 1.2. 方法一 vs 方法二结果对比
- **图表2: 两种方法的站点保留状态对比 (散点图)**
  - **目的**: 直观比较两种方法在站点选择上的异同。
  - **设计**: X轴为站点ID，Y轴为是否保留（0或1）。用两种不同颜色/形状的点代表两种方法的结果。对于不一致的点，可以使用特殊标记或添加连线。
  - **文件名**: `p1_retain_status_comparison.svg`

- **图表3: 保留站点的容量配置对比 (散点图/折线图)**
  - **目的**: 比较两种方法对相同保留站点的容量配置差异。
  - **设计**: X轴为站点ID（仅限在两种方法中都被保留的站点），Y轴为容量。绘制两条线或两组散点。可以添加一条 y=x 的参考线。对于差异较大的点，可以高亮显示。
  - **文件名**: `p1_capacity_configuration_comparison.svg`

- **图表4: 两种方法的成本构成对比 (堆叠柱状图)**
  - **目的**: 比较两种方法在总成本及其组成部分（失败惩罚、调度成本等）上的差异。
  - **设计**: X轴为方法（方法一、方法二），Y轴为成本。将总成本分解为不同部分，用不同颜色的堆叠柱表示。
  - **文件名**: `p1_cost_breakdown_comparison.svg`

### 1.3. 最优解分析 (聚焦方法二)
- **图表5: 保留站点的空间分布 (示意地图)**
  - **目的**: 展示保留站点的地理分布（虽然是模拟数据，但可以按ID或需求排序来模拟空间关系）。
  - **设计**: 使用 Plotly 创建一个交互式散点图。X轴可以是站点ID的某种排序（如按预测需求），Y轴可以是另一个维度（如ID本身或随机分布以模拟空间）。点的大小代表容量，颜色代表预测需求的正负和大小。
  - **文件名**: `p1_retained_stations_map.html` (交互式HTML)

- **图表6: 保留站点的容量与需求关系 (散点图)**
  - **目的**: 分析优化后容量配置与预测需求之间的关系。
  - **设计**: X轴为预测需求，Y轴为分配的容量。理想情况下，点应分布在 y=|x| 线附近。添加此参考线。可以使用颜色区分借车需求和还车需求。
  - **文件名**: `p1_capacity_vs_demand.svg`

- **图表7: 站点效率分析 (柱状图)**
  - **目的**: 评估每个保留站点的“效率”，即其容量与需求的匹配程度。
  - **设计**: X轴为站点ID，Y轴为效率指标（例如，`min(allocated_capacity, abs(predicted_demand)) / max(allocated_capacity, abs(predicted_demand))`）。柱子的高度代表效率，颜色可以代表需求大小。
  - **文件名**: `p1_station_efficiency.svg`

## 2. 问题二 (鲁棒优化) 可视化

### 2.1. 不确定性场景分析
- **图表8: 不同场景下总需求对比 (柱状图)**
  - **目的**: 展示5个场景下总需求（或需求分布）的差异。
  - **设计**: X轴为场景名称，Y轴为总需求或需求的标准差。可以使用误差线展示需求的波动范围。
  - **文件名**: `p2_scenario_demand_comparison.svg`

### 2.2. 鲁棒解 vs 确定性解对比
- **图表9: 站点保留状态终极对比 (桑基图/Sankey Diagram)**
  - **目的**: 高度可视化地展示从确定性解到鲁棒解的站点状态变化。
  - **设计**: 使用 Plotly 绘制桑基图。左侧节点代表确定性解的“保留”和“关闭”状态，右侧节点代表鲁棒解的“保留”和“关闭”状态。连接线的宽度代表站点数量。这是一种非常专业且炫酷的展示方式。
  - **文件名**: `p2_retain_status_sankey.html` (交互式HTML)

- **图表10: 鲁棒解在各场景下的成本表现 (折线图)**
  - **目的**: 展示鲁棒解在所有场景下的成本，特别是验证其在最坏情况下的性能。
  - **设计**: X轴为场景名称，Y轴为总成本。绘制一条线连接各点。用特殊标记突出显示最坏情况场景的成本。可以添加一条水平线表示该解的目标值（最坏情况成本）。
  - **文件名**: `p2_robust_solution_cost_across_scenarios.svg`

### 2.3. 鲁棒解分析
- **图表11: “关闭所有站点”策略的成本分析 (表格+图表)**
  - **目的**: 深入分析为何关闭所有站点是最优鲁棒解。
  - **设计**: 
    - **表格**: 创建一个复杂的表格，列出在鲁棒解（全关闭）下，每个场景的成本构成（失败惩罚为0，调度成本为0，总成本为0）。同时，计算并展示如果按问题一的方案（方法二）在各场景下会产生的成本，特别是最坏情况下的成本。
    - **图表**: 可以绘制一个条形图，对比“鲁棒解成本”和“确定性解在各场景下的成本”，以直观显示鲁棒解的优势（在最坏情况下成本最低）。
  - **文件名**: `p2_robust_vs_deterministic_cost_analysis.svg`

## 3. 综合对比与洞察
- **图表12: 问题一与问题二核心指标对比 (综合仪表盘/雷达图)**
  - **目的**: 在一个视图中综合比较两个问题的解在多个维度上的表现。
  - **设计**: 
    - **仪表盘**: 使用多个小图表（如小数位计数器、进度条）展示关键指标（保留站点数、总容量、平均成本、最坏情况成本）。
    - **雷达图**: 将几个关键性能指标（如成功率、成本、鲁棒性）标准化后绘制在雷达图上，比较两个解的综合表现。
  - **文件名**: `p1_vs_p2_overall_comparison_dashboard.svg` 或 `p1_vs_p2_radar_chart.svg`

## 4. 技术实现细节

- **中文字体支持**: 在 Python 脚本中，将显式设置 Matplotlib 和 Plotly 的字体为支持中文的字体（如 "SimHei" 黑体 或 "Microsoft YaHei" 微软雅黑），以防止乱码。对于 Plotly，将设置 `config` 以支持中文显示。
- **SVG 输出**: 使用 Matplotlib 的 `savefig` 和 Plotly 的 `write_image` (配合 `kaleido`) 将图表保存为 SVG 格式。
- **复杂表格**: 对于需要复杂格式的表格（如图表11），将使用 Pandas 的 `DataFrame` 结合 `to_html` 方法，并通过自定义 CSS 样式来实现炫酷的视觉效果，保存为 HTML 文件。或者，使用 Matplotlib 绘制表格图像。
- **文件命名**: 所有生成的图片将按照上述命名规则存放在 `pics` 文件夹中。

通过以上设计，我们将能够生成一套专业、详细、视觉冲击力强的可视化分析报告，全面展示优化工作的成果和洞察。