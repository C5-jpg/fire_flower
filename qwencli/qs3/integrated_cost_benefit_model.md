# 问题三：综合成本效益模型深度解析

## 核心目标

问题三的核心是构建一个**单一的、综合性的目标函数**，以最小化“社会总成本” $Z_{\text{social}}$。该函数将之前问题中分散的、甚至相互冲突的目标（运营成本、服务水平）统一到一个框架下进行量化和权衡，从而得出一个在全局视角下最优的决策。

---

## 第一步：精细化定义“社会总成本”

社会总成本 $Z_{\text{social}}$ 由三部分构成，我们需要对每一部分进行精确的数学刻画：

### 1. 调度成本 ($C_{\text{dispatch}}$)

这部分与问题一相同，是基于站点借还不平衡度的运营成本。
- **含义**: 站点的调度成本通常与该站点一天内总的借还活动量（即净流入/流出量的绝对值 $|D_i|$）相关。
- **模型**: $C_{\text{dispatch}} = \sum_{i \in I} K_{\text{dispatch},i} \cdot x_i$
- **符号说明**:
  - $I$: 所有站点的集合。
  - $K_{\text{dispatch},i}$: 站点 $i$ 的基础调度成本系数，与 $|D_i|$ 成正比。在问题一中，我们简化为 $|D_i|$。
  - $x_i \in \{0, 1\}$: 决定站点 $i$ 是否保留的二元变量 ($1$ 为保留, $0$ 为关闭)。

### 2. 空置损失 ($C_{\text{vacancy}}$)

这部分也与问题一相同，是一个二次惩罚项，反映了资源（停车位）与需求不匹配所造成的浪费。
- **含义**: 该成本项惩罚容量配置 $c_i$ 与预测需求 $D_i$ 之间的不匹配。无论容量是过剩还是不足，都会产生损失。
- **模型**: $C_{\text{vacancy}} = \sum_{i \in I} (D_i - c_i)^2$
- **符号说明**:
  - $D_i$: 站点 $i$ 的预测净需求量（借车数 - 还车数）。
  - $c_i \in \mathbb{Z}^+$: 站点 $i$ 的容量配置（如果站点被保留）。
- **二次方的特性**: 意味着，轻微的容量偏差（无论多或少）是可以接受的，但巨大的偏差将受到极其严厉的惩罚。这非常符合现实，一个空置率90%或拥堵率90%的站点，其负面效应远大于两个空置/拥堵率10%的站点之和。

### 3. 用户体验损失 ($C_{\text{user\_exp}}$) - 建模的关键与深化

这是问题三新增的核心部分，代表了因“无车可借”或“无桩可还”给用户带来的负面体验的货币化度量。
- **含义**: 当站点的实际容量 $c_i$ 难以满足预测需求 $D_i$ 时，就会产生用户的服务失败。
  - 如果 $D_i > 0$ (净借车需求) 且 $c_i$ 不足以满足，则会发生“无车可借”。
  - 如果 $D_i < 0$ (净还车需求) 且 $c_i$ 不足以满足（即空位不足），则会发生“无桩可还”。
- **模型**: $C_{\text{user\_exp}} = P \cdot \sum_{i \in I} (\max(0, D_i - c_i) + \max(0, -D_i - c_i))$
- **符号说明**:
  - $P$ (Penalty Coefficient): **“每一次服务失败的单位社会成本”**。这是本模型的关键参数。
  - $\max(0, D_i - c_i)$: 站点 $i$ 因借车需求大于容量而产生的服务失败量。
  - $\max(0, -D_i - c_i)$: 站点 $i$ 因还车需求大于空位数（即 $|D_i| > c_i$ 且 $D_i < 0$）而产生的服务失败量。
- **统一表达式**: 可以简化为 $C_{\text{user\_exp}} = P \cdot \sum_{i \in I} \max(0, |D_i| - c_i)$

---

## 第二步：确定关键参数 $P$ 的取值

$P$ 是用户体验损失成本的核心，其取值直接影响模型的决策。简单地设一个数字是不够专业的，我们需要深入探讨它的内涵和取值依据。

### 经济学视角

$P$ 可以被理解为用户的“机会成本”。一次失败的借还可能导致用户：

1.  **时间成本**: 花费更多时间等待、寻找其他站点或替代交通工具。
2.  **金钱成本**: 选择更昂贵的出行方式（如出租车、网约车）。
3.  **效率损失**: 耽误工作或约会，影响生活品质。

### 取值策略与依据

在实际应用或竞赛中，我们可以设定一个合理的、可解释的 $P$ 值。

- **参考单次骑行的平均费用**: 如果一次骑行平均花费2元，那么一次失败的体验至少造成了同等的直接损失。但这可能低估了用户的不便。
- **参考替代交通的额外成本**: 如果用户因无车/无桩而被迫打车，额外花费可能是10-20元。这是一个更贴近实际损失的估计。
- **参考城市居民的平均小时工资**: 将用户因服务失败而耽误的时间（如10-15分钟）折算成金钱。例如，如果平均时薪为30元，则15分钟的时间成本约为7.5元。

### 推荐论述

> “我们设定单次服务失败的惩罚成本 $P$ 为 **15元**。该值参考了本市居民完成类似短途出行时，选择出租车相比共享单车的平均溢价成本（约15-20元），并综合考虑了用户因寻找车辆或车位所损失的时间价值。这一设定体现了模型对用户出行便利性和时间价值的高度重视，确保了优化结果在提升运营效率的同时，也能保障卓越的用户体验。”

这样的论述将极大提升方案的**专业性**和**说服力**。

---

## 第三步：整合综合成本效益模型

将上述三部分成本整合，得到问题三的最终优化目标：

### 最小化社会总成本 $Z_{\text{social}}$

$$
\min Z_{\text{social}} = C_{\text{dispatch}} + C_{\text{vacancy}} + C_{\text{user\_exp}}
$$

$$
\min Z_{\text{social}} = \sum_{i \in I} K_{\text{dispatch},i} \cdot x_i + \sum_{i \in I} (D_i - c_i)^2 + P \cdot \sum_{i \in I} \max(0, |D_i| - c_i)
$$

### 约束条件

该模型的约束条件与问题一基本一致：

- 容量与站点状态的关系:
  - $c_i \leq C_{\text{max}} \cdot x_i, \quad \forall i \in I$
  - $c_i \geq C_{\text{min}} \cdot x_i, \quad \forall i \in I$
- 变量类型:
  - $x_i \in \{0, 1\}, \quad \forall i \in I$
  - $c_i \in \mathbb{Z}^+, \quad \forall i \in I$

---

## 第四步：模型特性与求解策略分析

1.  **混合整数二次规划 (MIQP)**: 目标函数包含线性项、二次项 $(D_i - c_i)^2$ 和非光滑项 $\max(0, |D_i| - c_i)$。这是一个复杂的优化问题。
2.  **非光滑项处理**: $\max(0, |D_i| - c_i)$ 可以通过引入辅助变量和约束进行线性化，将其转化为标准的MIQP问题。
    - 引入 $u_i = \max(0, |D_i| - c_i)$
    - 约束: $u_i \geq |D_i| - c_i, \quad u_i \geq 0$
    - 由于 $c_i \geq 0$，$|D_i|$ 是常数，这组约束是线性可表达的。
3.  **求解器选择**: 需要使用能处理MIQP问题的求解器，例如 Gurobi, CPLEX, 或者通过适当的线性化后使用 CBC/SCIP 等。

通过构建这个综合成本效益模型，我们能够在一个统一的框架内，量化并平衡运营效率、资源利用效率和用户满意度，从而得出更为全面和稳健的优化决策。